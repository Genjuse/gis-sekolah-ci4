<?php

namespace App\Controllers;

use App\Models\ModelSetting;
use App\Models\ModelWilayah;
use App\Models\ModelSekolah;
use App\Models\ModelJenjang;


class Home extends BaseController
{
    protected $ModelSetting, $ModelAdmin, $ModelJenjang, $ModelWilayah, $ModelSekolah;
    public $detail_id_wilayah;
    public function __construct()
    {

        $this->ModelSetting = new ModelSetting();
        $this->ModelWilayah = new ModelWilayah();
        $this->ModelSekolah = new ModelSekolah();
        $this->ModelJenjang = new ModelJenjang();
    }


    public function index()
    {
        $data = [
            'judul' => 'Home',
            'page' => 'v_home',
            'web' => $this->ModelSetting->DataWeb(),
            'wilayah' => $this->ModelWilayah->AllData(),
            'sekolah' => $this->ModelSekolah->AllData(),
            'jenjang' => $this->ModelJenjang->AllData(),
        ];
        return view('v_template_front_end', $data);
    }

    public function Wilayah($id_wilayah)
    {
        $dw = $this->ModelWilayah->DetailData($id_wilayah);
        $this->detail_id_wilayah = $id_wilayah; // Simpan id_wilayah di properti class

        $data = [
            'judul' => $dw['nama_wilayah'],
            'page' => 'v_detail_wilayah',
            'web' => $this->ModelSetting->DataWeb(),
            'wilayah' => $this->ModelWilayah->AllData(),
            'jenjang' => $this->ModelJenjang->AllData(),
            'detailwilayah' => $this->ModelWilayah->DetailData($id_wilayah),
            'sekolah' => $this->ModelSekolah->AllDataPerWilayah($id_wilayah),
        ];

        return view('v_template_front_end', $data);
    }

    public function Jenjang()
    {
        $id_jenjang = intval($this->request->getPost('jenjang'));
        $id_wilayah = intval($this->request->getPost('id_wilayah_input'));
        // Menggunakan properti class untuk mendapatkan id_wilayah

        $dj = $this->ModelJenjang->DetailData($id_jenjang);


        // menampilkan jika tidak ada parameter wilayah
        if (empty($id_wilayah)) {
            $data = [
                'detailwilayah' => [
                    'geojson' => '{
                    "type": "FeatureCollection",
                    "name": "GONDOKUSUMAN",
                    "crs": {
                        "type": "name",
                        "properties": {
                            "name": "urn:ogc:def:crs:OGC:1.3:CRS84"
                        }
                    },
                    "features": [
                        {
                            "type": "Feature",
                            "properties": {
                                "PROVNO": "34",
                                "KABKOTNO": "71",
                                "KECNO": "060",
                                "DESANO": "001",
                                "PROVINSI": "DAERAH ISTIMEWA YOGYAKARTA",
                                "KABKOT": "YOGYAKARTA",
                                "KECAMATAN": "GONDOKUSUMAN",
                                "ID2013": "3471060001",
                                "DESA": "BACIRO",
                                "DESA_1": "BACIRO",
                                "ID2012": "3471060001",
                                "IDKAB2": "3471",
                                "IDKEC_2": "3471060"
                            },
                            "geometry": {
                                "type": "MultiPolygon",
                                "coordinates": [
                                    [
                                        [
                                            [
                                                110.39619869141669,
                                                -7.790783955914673,
                                                0
                                            ],
                                            [
                                                110.39616357828669,
                                                -7.790364396999152,
                                                0
                                            ],
                                            [
                                                110.39602135140441,
                                                -7.790417566717203,
                                                0
                                            ],
                                            [
                                                110.39587917038759,
                                                -7.790439047024247,
                                                0
                                            ],
                                            [
                                                110.39586390619448,
                                                -7.79058746663809,
                                                0
                                            ],
                                            [
                                                110.3956146806731,
                                                -7.790617134373026,
                                                0
                                            ],
                                            [
                                                110.39543075492557,
                                                -7.790593520874136,
                                                0
                                            ],
                                            [
                                                110.39528693264597,
                                                -7.790593315828644,
                                                0
                                            ],
                                            [
                                                110.39533519206564,
                                                -7.790760173343205,
                                                0
                                            ],
                                            [
                                                110.39532326705533,
                                                -7.790911933938407,
                                                0
                                            ],
                                            [
                                                110.39528768268059,
                                                -7.791483358669851,
                                                0
                                            ],
                                            [
                                                110.39485895517679,
                                                -7.79220523188572,
                                                0
                                            ],
                                            [
                                                110.39483230466735,
                                                -7.792572729048022,
                                                0
                                            ],
                                            [
                                                110.39413554861689,
                                                -7.792584142344108,
                                                0
                                            ],
                                            [
                                                110.39328951140202,
                                                -7.792582930957295,
                                                0
                                            ],
                                            [
                                                110.39308814330337,
                                                -7.792595626686651,
                                                0
                                            ],
                                            [
                                                110.39308774580294,
                                                -7.792871411885951,
                                                0
                                            ],
                                            [
                                                110.39250841693007,
                                                -7.792842194711316,
                                                0
                                            ],
                                            [
                                                110.39206230283321,
                                                -7.792863812614694,
                                                0
                                            ],
                                            [
                                                110.39203117999513,
                                                -7.793139553747288,
                                                0
                                            ],
                                            [
                                                110.39197677460862,
                                                -7.793579967041655,
                                                0
                                            ],
                                            [
                                                110.39141227195901,
                                                -7.793529362190146,
                                                0
                                            ],
                                            [
                                                110.39092842770494,
                                                -7.793475041339928,
                                                0
                                            ],
                                            [
                                                110.39095971691758,
                                                -7.793084390232288,
                                                0
                                            ],
                                            [
                                                110.39064097739933,
                                                -7.793060950302468,
                                                0
                                            ],
                                            [
                                                110.39040673728127,
                                                -7.793033799769891,
                                                0
                                            ],
                                            [
                                                110.39031441198071,
                                                -7.793137086906867,
                                                0
                                            ],
                                            [
                                                110.38966678229635,
                                                -7.793001597745377,
                                                0
                                            ],
                                            [
                                                110.38936192111595,
                                                -7.79314337586591,
                                                0
                                            ],
                                            [
                                                110.38902770786261,
                                                -7.793196518604297,
                                                0
                                            ],
                                            [
                                                110.38873191094908,
                                                -7.793242055776108,
                                                0
                                            ],
                                            [
                                                110.38858966338246,
                                                -7.793341439855386,
                                                0
                                            ],
                                            [
                                                110.38831710495063,
                                                -7.793252949264087,
                                                0
                                            ],
                                            [
                                                110.38814280464693,
                                                -7.793102184218217,
                                                0
                                            ],
                                            [
                                                110.38715860638476,
                                                -7.79320335525048,
                                                0
                                            ],
                                            [
                                                110.38701281369057,
                                                -7.793641575098444,
                                                0
                                            ],
                                            [
                                                110.38683682715802,
                                                -7.794184251202054,
                                                0
                                            ],
                                            [
                                                110.38671184207796,
                                                -7.794160000083785,
                                                0
                                            ],
                                            [
                                                110.38569184180527,
                                                -7.79405000040704,
                                                0
                                            ],
                                            [
                                                110.38515184208407,
                                                -7.793950000292096,
                                                0
                                            ],
                                            [
                                                110.38477184164735,
                                                -7.793910000246154,
                                                0
                                            ],
                                            [
                                                110.38448184176377,
                                                -7.793859999739041,
                                                0
                                            ],
                                            [
                                                110.38363721558527,
                                                -7.793661791858,
                                                0
                                            ],
                                            [
                                                110.38343149836513,
                                                -7.794256185274531,
                                                0
                                            ],
                                            [
                                                110.3834923123205,
                                                -7.794278524434208,
                                                0
                                            ],
                                            [
                                                110.383687826732,
                                                -7.79372659430674,
                                                0
                                            ],
                                            [
                                                110.38433003800105,
                                                -7.793865999116392,
                                                0
                                            ],
                                            [
                                                110.38422457630328,
                                                -7.794222951727683,
                                                0
                                            ],
                                            [
                                                110.38427526029523,
                                                -7.79423718529765,
                                                0
                                            ],
                                            [
                                                110.3842507735545,
                                                -7.794338287981386,
                                                0
                                            ],
                                            [
                                                110.38401355668053,
                                                -7.794281305137964,
                                                0
                                            ],
                                            [
                                                110.38391082442521,
                                                -7.794666144826614,
                                                0
                                            ],
                                            [
                                                110.38336184227533,
                                                -7.794599999690135,
                                                0
                                            ],
                                            [
                                                110.38322760766809,
                                                -7.794932665210155,
                                                0
                                            ],
                                            [
                                                110.38310766958347,
                                                -7.795277913145018,
                                                0
                                            ],
                                            [
                                                110.38299967629422,
                                                -7.795623178167013,
                                                0
                                            ],
                                            [
                                                110.38290378068517,
                                                -7.795861261088213,
                                                0
                                            ],
                                            [
                                                110.38286768999207,
                                                -7.796039875439789,
                                                0
                                            ],
                                            [
                                                110.3827719337779,
                                                -7.796182668894893,
                                                0
                                            ],
                                            [
                                                110.38275967691776,
                                                -7.796397051082895,
                                                0
                                            ],
                                            [
                                                110.3826593620401,
                                                -7.7969092455651,
                                                0
                                            ],
                                            [
                                                110.38251200002898,
                                                -7.797202105292769,
                                                0
                                            ],
                                            [
                                                110.38237544067422,
                                                -7.797285640619602,
                                                0
                                            ],
                                            [
                                                110.38214443991419,
                                                -7.797358572040327,
                                                0
                                            ],
                                            [
                                                110.38188199975473,
                                                -7.797400056867012,
                                                0
                                            ],
                                            [
                                                110.38187161168574,
                                                -7.797326772912108,
                                                0
                                            ],
                                            [
                                                110.3822287081885,
                                                -7.797149357356794,
                                                0
                                            ],
                                            [
                                                110.38234460022332,
                                                -7.796845984554448,
                                                0
                                            ],
                                            [
                                                110.38245010418915,
                                                -7.79646932959567,
                                                0
                                            ],
                                            [
                                                110.38224075370802,
                                                -7.796092215083519,
                                                0
                                            ],
                                            [
                                                110.38164303909511,
                                                -7.795745933827583,
                                                0
                                            ],
                                            [
                                                110.38140189757964,
                                                -7.795578111340564,
                                                0
                                            ],
                                            [
                                                110.38116032618822,
                                                -7.795703361720587,
                                                0
                                            ],
                                            [
                                                110.38098192407674,
                                                -7.795692633707887,
                                                0
                                            ],
                                            [
                                                110.38079287399208,
                                                -7.795786559801723,
                                                0
                                            ],
                                            [
                                                110.38070891328587,
                                                -7.795786436594589,
                                                0
                                            ],
                                            [
                                                110.38060348486307,
                                                -7.79611075730541,
                                                0
                                            ],
                                            [
                                                110.38043576310011,
                                                -7.795974441666988,
                                                0
                                            ],
                                            [
                                                110.38040184157185,
                                                -7.79619999973006,
                                                0
                                            ],
                                            [
                                                110.38047722004785,
                                                -7.796330378044338,
                                                0
                                            ],
                                            [
                                                110.38041374230053,
                                                -7.796675693428359,
                                                0
                                            ],
                                            [
                                                110.38052889509262,
                                                -7.796874733182193,
                                                0
                                            ],
                                            [
                                                110.3805911119904,
                                                -7.797387702880023,
                                                0
                                            ],
                                            [
                                                110.38053184217094,
                                                -7.797930000369071,
                                                0
                                            ],
                                            [
                                                110.380491842125,
                                                -7.798009999561675,
                                                0
                                            ],
                                            [
                                                110.3804515147258,
                                                -7.798209999791474,
                                                0
                                            ],
                                            [
                                                110.38029184189512,
                                                -7.798180000206703,
                                                0
                                            ],
                                            [
                                                110.3797618417358,
                                                -7.798100000114729,
                                                0
                                            ],
                                            [
                                                110.37966184162084,
                                                -7.798089999653559,
                                                0
                                            ],
                                            [
                                                110.37947184185222,
                                                -7.798080000091758,
                                                0
                                            ],
                                            [
                                                110.37922184201459,
                                                -7.798040000045816,
                                                0
                                            ],
                                            [
                                                110.37900184176173,
                                                -7.798029999584646,
                                                0
                                            ],
                                            [
                                                110.37860184220142,
                                                -7.797999999999874,
                                                0
                                            ],
                                            [
                                                110.37822184176478,
                                                -7.797970000415013,
                                                0
                                            ],
                                            [
                                                110.37797184192715,
                                                -7.797999999999874,
                                                0
                                            ],
                                            [
                                                110.37796184236535,
                                                -7.797939999930961,
                                                0
                                            ],
                                            [
                                                110.3778118417433,
                                                -7.797730000139182,
                                                0
                                            ],
                                            [
                                                110.37771184162835,
                                                -7.797560000393524,
                                                0
                                            ],
                                            [
                                                110.37767184158241,
                                                -7.797349999702554,
                                                0
                                            ],
                                            [
                                                110.37767147375966,
                                                -7.797280000071751,
                                                0
                                            ],
                                            [
                                                110.37772184208953,
                                                -7.796780000396577,
                                                0
                                            ],
                                            [
                                                110.37777184169735,
                                                -7.795940000330539,
                                                0
                                            ],
                                            [
                                                110.37784184222744,
                                                -7.794980000126763,
                                                0
                                            ],
                                            [
                                                110.37785184178924,
                                                -7.794850000427047,
                                                0
                                            ],
                                            [
                                                110.37788184227338,
                                                -7.794280000221612,
                                                0
                                            ],
                                            [
                                                110.37790184229635,
                                                -7.793879999762012,
                                                0
                                            ],
                                            [
                                                110.37791184185815,
                                                -7.793629999924381,
                                                0
                                            ],
                                            [
                                                110.37793184188112,
                                                -7.79254999958269,
                                                0
                                            ],
                                            [
                                                110.37792184231932,
                                                -7.792290000183169,
                                                0
                                            ],
                                            [
                                                110.37791184185815,
                                                -7.791820000092766,
                                                0
                                            ],
                                            [
                                                110.37794184234238,
                                                -7.791220000302559,
                                                0
                                            ],
                                            [
                                                110.37797184192715,
                                                -7.790899999934844,
                                                0
                                            ],
                                            [
                                                110.37802184243426,
                                                -7.790570000005328,
                                                0
                                            ],
                                            [
                                                110.37809184206506,
                                                -7.790300000144725,
                                                0
                                            ],
                                            [
                                                110.3781418416729,
                                                -7.790059999868983,
                                                0
                                            ],
                                            [
                                                110.37816184169587,
                                                -7.789999999799981,
                                                0
                                            ],
                                            [
                                                110.37823012631942,
                                                -7.789799624552831,
                                                0
                                            ],
                                            [
                                                110.378289999584,
                                                -7.789799999570182,
                                                0
                                            ],
                                            [
                                                110.37885999978934,
                                                -7.789749999962439,
                                                0
                                            ],
                                            [
                                                110.3796300002245,
                                                -7.789680000331636,
                                                0
                                            ],
                                            [
                                                110.380020000223,
                                                -7.789640000285605,
                                                0
                                            ],
                                            [
                                                110.38051000033639,
                                                -7.789600000239663,
                                                0
                                            ],
                                            [
                                                110.38058498311068,
                                                -7.789595466757273,
                                                0
                                            ],
                                            [
                                                110.3806283637082,
                                                -7.789593195969093,
                                                0
                                            ],
                                            [
                                                110.38068999964392,
                                                -7.789589968302248,
                                                0
                                            ],
                                            [
                                                110.38094000038083,
                                                -7.789540000170661,
                                                0
                                            ],
                                            [
                                                110.38160000023996,
                                                -7.789480000101747,
                                                0
                                            ],
                                            [
                                                110.38254999998274,
                                                -7.789429999594635,
                                                0
                                            ],
                                            [
                                                110.38287000035037,
                                                -7.789400000009863,
                                                0
                                            ],
                                            [
                                                110.38353999977139,
                                                -7.789409999571664,
                                                0
                                            ],
                                            [
                                                110.3836500003474,
                                                -7.789400000009863,
                                                0
                                            ],
                                            [
                                                110.3839899998388,
                                                -7.789370000425002,
                                                0
                                            ],
                                            [
                                                110.38417000004564,
                                                -7.789350000402031,
                                                0
                                            ],
                                            [
                                                110.38456999960596,
                                                -7.789310000356089,
                                                0
                                            ],
                                            [
                                                110.38601999992319,
                                                -7.789170000195202,
                                                0
                                            ],
                                            [
                                                110.38659000012863,
                                                -7.789150000172143,
                                                0
                                            ],
                                            [
                                                110.38669999980537,
                                                -7.789150000172143,
                                                0
                                            ],
                                            [
                                                110.38724000042586,
                                                -7.789090000103229,
                                                0
                                            ],
                                            [
                                                110.38743999975638,
                                                -7.789050000057287,
                                                0
                                            ],
                                            [
                                                110.38784999977787,
                                                -7.789000000449544,
                                                0
                                            ],
                                            [
                                                110.38817999970739,
                                                -7.788980000426573,
                                                0
                                            ],
                                            [
                                                110.3888399995665,
                                                -7.788929999919372,
                                                0
                                            ],
                                            [
                                                110.38928999963395,
                                                -7.788869999850458,
                                                0
                                            ],
                                            [
                                                110.39082000004315,
                                                -7.788789999758574,
                                                0
                                            ],
                                            [
                                                110.3911999995805,
                                                -7.788760000173713,
                                                0
                                            ],
                                            [
                                                110.39223999987624,
                                                -7.78868999964363,
                                                0
                                            ],
                                            [
                                                110.39264000033593,
                                                -7.788629999574628,
                                                0
                                            ],
                                            [
                                                110.39283999966645,
                                                -7.788599999989856,
                                                0
                                            ],
                                            [
                                                110.3934099998718,
                                                -7.788590000428055,
                                                0
                                            ],
                                            [
                                                110.39363000012457,
                                                -7.788570000405084,
                                                0
                                            ],
                                            [
                                                110.39377999984734,
                                                -7.788559999943825,
                                                0
                                            ],
                                            [
                                                110.39417406837876,
                                                -7.788514177686992,
                                                0
                                            ],
                                            [
                                                110.3943746711543,
                                                -7.788501419005147,
                                                0
                                            ],
                                            [
                                                110.39444272105494,
                                                -7.788501516131898,
                                                0
                                            ],
                                            [
                                                110.39449695197293,
                                                -7.788493640768781,
                                                0
                                            ],
                                            [
                                                110.3945601428365,
                                                -7.788484465885261,
                                                0
                                            ],
                                            [
                                                110.39463943606128,
                                                -7.788484579199775,
                                                0
                                            ],
                                            [
                                                110.39482265674044,
                                                -7.788472924885372,
                                                0
                                            ],
                                            [
                                                110.39708359283372,
                                                -7.788329119692907,
                                                0
                                            ],
                                            [
                                                110.39711518601716,
                                                -7.788325073643101,
                                                0
                                            ],
                                            [
                                                110.39710790690457,
                                                -7.78864401011278,
                                                0
                                            ],
                                            [
                                                110.39719860083497,
                                                -7.788817511818493,
                                                0
                                            ],
                                            [
                                                110.3972771089516,
                                                -7.788926074378679,
                                                0
                                            ],
                                            [
                                                110.39736301219345,
                                                -7.789097251336887,
                                                0
                                            ],
                                            [
                                                110.39741463327881,
                                                -7.789498148420684,
                                                0
                                            ],
                                            [
                                                110.39738903857344,
                                                -7.78976536937618,
                                                0
                                            ],
                                            [
                                                110.39737876022176,
                                                -7.789847444204003,
                                                0
                                            ],
                                            [
                                                110.3972884961673,
                                                -7.790107011928917,
                                                0
                                            ],
                                            [
                                                110.39714395083286,
                                                -7.790266607417831,
                                                0
                                            ],
                                            [
                                                110.39705303297126,
                                                -7.790337983011355,
                                                0
                                            ],
                                            [
                                                110.39672772660354,
                                                -7.790532967722132,
                                                0
                                            ],
                                            [
                                                110.39633071728896,
                                                -7.790732617216314,
                                                0
                                            ],
                                            [
                                                110.39628756062264,
                                                -7.790758584241111,
                                                0
                                            ],
                                            [
                                                110.39619869141669,
                                                -7.790783955914673,
                                                0
                                            ]
                                        ]
                                    ]
                                ]
                            }
                        }
                    ]
                }',
                    'warna' => 'red',
                    'nama_wilayah' => 'Semua Wilayah'
                ],
                'web' => $this->ModelSetting->DataWeb(),
                'sekolah' => $this->ModelSekolah->AllDataPerJenjang($id_jenjang),
                'page' => 'v_sekolah_per_jenjang',
                'judul' => $dj['jenjang'],
                'wilayah' => $this->ModelWilayah->AllData(),
                'jenjang' => $this->ModelJenjang->AllData()
            ];

            // dd($data);
            return view('v_template_front_end', $data);
        } else {
            // menampilkan jika ada parameter wilayah dan jenjang
            $data = [
                'judul' => $dj['jenjang'],
                'page' => 'v_sekolah_per_jenjang',
                'web' => $this->ModelSetting->DataWeb(),
                'wilayah' => $this->ModelWilayah->AllData(),
                'jenjang' => $this->ModelJenjang->AllData(),
                'detailwilayah' => $this->ModelWilayah->DetailData($id_wilayah),
                'sekolah' => $this->ModelSekolah->getCertainSchools($id_jenjang, $id_wilayah),

            ];
            // dd($data);
            // return view('v_template_front_end', $data);
        }
    }
    public function DetailSekolah($id_sekolah)
    {
        $sekolah = $this->ModelSekolah->DetailData($id_sekolah);
        $data = [
            'judul' => $sekolah['nama_sekolah'],
            'page' => 'v_detail_sekolah',
            'web' => $this->ModelSetting->DataWeb(),
            'wilayah' => $this->ModelWilayah->AllData(),
            'jenjang' => $this->ModelJenjang->AllData(),
            'sekolah' => $sekolah,

        ];
        return view('v_template_front_end', $data);
    }
}
